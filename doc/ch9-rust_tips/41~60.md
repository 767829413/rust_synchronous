# Rust tips 41~60

## Tip 41
-------

ç±»ä¼¼äº Go è¯­è¨€ä¸­çš„é€šé“ï¼ˆGo çš„ `channel`ï¼‰ï¼ŒRust ä¸­çš„ `std::sync::mpsc` æä¾›äº†ä¸€ç§çº¿ç¨‹é—´å®‰å…¨åœ°è¯»å†™æ•°æ®çš„æœºåˆ¶:

```rust
fn main() {
    use std::sync::mpsc;
    use std::thread;
    use std::time::Duration;
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        // æš‚åœå½“å‰çº¿ç¨‹çš„æ‰§è¡Œ2ç§’
        thread::sleep(Duration::from_secs(2));
        tx.send(val).unwrap();
        println!("é€€å‡ºæ‰§è¡Œ")
    });

    let received = rx.recv().unwrap();
    println!("Got: {}", received);
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé€šé“ï¼Œç„¶ååœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å‘é€äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç­‰å¾…æ¥æ”¶è¿™ä¸ªå­—ç¬¦ä¸²å¹¶æ‰“å°å®ƒã€‚

## Tip 42
-------

å¸Œæœ›åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œè®©ç¼–è¯‘å™¨å’Œä»£ç æ£€æŸ¥å·¥å…·å®æ—¶åœ°æŒ‡å‡ºå¹¶ååŠ©è§£å†³å‡ºç°çš„é—®é¢˜å—ï¼Ÿ

ä¸å¦¨è¯•è¯• [Bacon](https://crates.io/crates/bacon)

```bash
cargo install --locked bacon

bacon

 rust_synchronous   check    1 error   

 1  error[E0432]: unresolved import `std::hint::likely`
   --> src/main.rs:13:9
    |
 13 |     use std::hint::likely;
    |         ^^^^^^^^^^^^^^^^^ no `likely` in `hint`
 
 For more information about this error, try `rustc --explain E0432`.
 error: could not compile `synchronous` (bin "synchronous") due to 1 previous error
```

## Tip 43
-------

é™¤äº†æ ‡å‡†åº“ä¸­çš„ `std::HashMap`ï¼ŒRust è¿˜ä¸ºç‰¹å®šåœºæ™¯æä¾›äº†å…¶ä»–å“ˆå¸Œè¡¨å˜ä½“ï¼š

* `IndexMap`ï¼ˆ`indexmap` åº“ï¼‰ï¼šä¿æŒé”®çš„æ’å…¥é¡ºåºã€‚
    
* `BTreeMap`ï¼ˆä½äº `std::collections`ï¼‰ï¼šæŒ‰ç…§é”®çš„æ’åºé¡ºåºç»´æŠ¤å…ƒç´ ã€‚
    
* `DashMap`ï¼ˆ`dashmap` åº“ï¼‰ï¼šæ— é”å¹¶å‘æ•£åˆ—æ˜ å°„ï¼Œé€‚ç”¨äºå¹¶å‘æˆ–å¤šçº¿ç¨‹ä»£ç ã€‚
    
## Tip 44
-------

ä½¿ç”¨ actix_web çš„ Rust ç½‘é¡µæœåŠ¡å™¨ï¼Œå…·å¤‡é™æ€æ–‡ä»¶æœåŠ¡åŠŸèƒ½ï¼Œå¹¶é»˜è®¤å°†è¯·æ±‚è·¯ç”±åˆ° `index.html`ã€‚å‡ ä¹å’Œ JavaScript ä¸€æ ·ç®€å•,å¯¹å—ï¼Ÿ

```rust
use actix_files::NamedFile;
use actix_web::HttpRequest;
use std::path::PathBuf;

async fn index(req: HttpRequest) -> actix_web::Result<NamedFile> {
    let path: PathBuf = req.match_info().query("filename").parse().unwrap();
    Ok(NamedFile::open(path)?)
}

#[actix_web::main]
async fn main() -> std::io::Result<()> {
    use actix_web::{web, App, HttpServer};

    HttpServer::new(|| App::new().route("/{filename:.*}", web::get().to(index)))
        .bind(("127.0.0.1", 8080))?
        .run()
        .await
}
```

## Tip 45
-------

å¯¹äºæƒ³è¦æåº¦ä¼˜åŒ–ä»£ç çš„ä½ ä»¬ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„å°çŸ¥è¯†ï¼š
`std::intrinsics` å…è®¸ä½ å‘Šè¯‰ç¼–è¯‘å™¨æŸä¸ªå¸ƒå°”è¡¨è¾¾å¼å¾ˆå¯èƒ½æ˜¯çœŸçš„ï¼Œä»è€Œå¯ç”¨ä¼˜åŒ–çš„åˆ†æ”¯é¢„æµ‹ï¼š

**This is a nightly-only experimental API. (core_intrinsics)**

```rust
fn main() {
    use std::intrinsics::likely;
    let x = 42;
    if likely(x > 0) {
        println!("x is positive");
    } else {
        println!("x is not positive");
    }
}
```

## Tip 46
-------

ä½ æ˜¯å¦æ›¾è¢« PartialEq å’Œ Eq è¿™ä¸¤ä¸ª #trait ææ™•è¿‡ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿæ¦‚è§ˆï¼š

* `PartialEq`ï¼šé€šè¿‡ `eq` æ–¹æ³•å®ç°ï¼ˆä¸è¦ä¸ `Eq` æ··æ·†ï¼ï¼‰ï¼Œå®ƒå¯ç”¨äº†ç›¸ç­‰æ€§ï¼ˆ`==`ï¼‰æ£€æŸ¥ã€‚å¦‚æœé¡¹ç›®ä¸å¯æ¯”è¾ƒï¼Œåˆ™ `eq` è¿”å› `false`ã€‚
    
* `Eq`ï¼šä¸€ä¸ªæ²¡æœ‰è‡ªå·±æ–¹æ³•çš„â€œæ ‡è®° Traitâ€ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥è¿›è¡Œç­‰ä»·æ¯”è¾ƒï¼Œå¹¶ç¡®ä¿ç­‰ä»·å…³ç³»æ˜¯è‡ªåçš„ã€å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚
    
## Tip 47
-------

ä¸€äº›é¿å…ä½¿ç”¨å¯æ€•çš„`clone()`æ–¹æ³•çš„ç­–ç•¥åŒ…æ‹¬ï¼š

* å‘åªè¯»å‡½æ•°ä¼ é€’å€Ÿç”¨ï¼ˆ`&`ï¼‰æ—¶ä½¿ç”¨å¼•ç”¨
    
* åˆ©ç”¨ `Rc<T>` æˆ– `Arc<T>` æ¥å…±äº«æ‰€æœ‰æƒ
    
* å®ç° `Copy` ç‰¹æ€§ï¼ˆç±»ä¼¼ C è¯­è¨€ä¸­çš„ memcpyï¼‰
    
* ä½¿ç”¨ `Cow<T>`ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰æ¥åŠè‡ªåŠ¨ç®¡ç†å¤åˆ¶è¿‡ç¨‹
    
## Tip 48
-------

Rust åœ¨å¤„ç†çº¿ç¨‹å’Œè¯»å–å®ƒä»¬çš„è¿”å›å€¼æ–¹é¢çœŸæ­£å¤§æ”¾å¼‚å½©çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œè¿™çœ‹èµ·æ¥æ¯”è®¸å¤šå…¶ä»–è¯­è¨€åšèµ·æ¥è¦ç®€å•å¾—å¤šã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¤„ç†ä¸¤ä¸ªçº¿ç¨‹ç»“æœçš„ç®€å•ç¤ºä¾‹ï¼š

```rust
fn main() {
    use std::thread;
    let handle1 = thread::spawn(|| 1);
    let handle2 = thread::spawn(|| 2);

    let result1 = handle1.join().unwrap();
    let result2 = handle2.join().unwrap();

    println!("Result: {}", result1 + result2);
}
```

## Tip 49
-------

ä½¿ç”¨ `Rayon` åº“å¯¹ for å¾ªç¯è¿›è¡Œç®€å•å¹¶è¡ŒåŒ–ï¼Œåªéœ€æ·»åŠ å¯¼å…¥å¹¶ä½¿ç”¨ `Rayon` æä¾›çš„ `.par_iter()` å¹¶è¡Œè¿­ä»£å™¨ã€‚

è¯¥ä»£ç ç”¨äºç»Ÿè®¡å¤§äº 0 çš„å…ƒç´ ã€‚é¢„æœŸçš„åŠ é€Ÿæ•ˆæœå¤§çº¦ä¸º X å€ï¼Œå…¶ä¸­ X ä»£è¡¨ä½ æ‹¥æœ‰çš„ CPU æ ¸å¿ƒæ•°é‡ï¼š

```rust
fn main() {
    use rayon::prelude::*;

    let numbers = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    let count = numbers.par_iter().filter(|&x| *x > 0).count();
    println!("Count: {}", count);
}
```

## Tip 50
-------

å¦‚æœä½ æ­£åœ¨è°ƒè¯•ä½ çš„è¿­ä»£å™¨ï¼Œå¹¶ä¸”åªæƒ³æµ‹è¯•æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œä½ å¯ä»¥ä½¿ç”¨ `myvec.iter().take(N)` æ¥ä»…å¯¹å‰ N ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œã€‚

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹è¾“å…¥è¿›è¡Œåˆ‡ç‰‡ï¼š`&myvec[0..N].iter()`

```rust
fn main() {
    let myvec = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    // Using .iter().take(N) to operate on the first N elements
    for val in myvec.iter().take(5) {
        println!("Using iter().take(N): {}", val);
    }

    // Using slicing to operate on the first N elements
    for val in &myvec[0..5].iter() {
        println!("Using slicing: {}", val);
    }
}
```

## Tip 51
-------

åœ¨è¿­ä»£å™¨ä¸­å¯¹ä¸€åˆ—å¯é€‰å€¼ï¼ˆ`Option`ï¼‰ä½¿ç”¨ `map()` æ„Ÿåˆ°æ£˜æ‰‹ï¼Ÿ

`filter_map()` å·§å¦™åœ°å¤„ç†äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä¼šå¿½ç•¥ `None` å€¼ï¼Œåªå¤„ç† `Some()` å€¼ï¼š

```rust
fn main() {
    let numbers = vec![Some(1), None, Some(3), None, Some(5)];
    let sum: i32 = numbers.iter().filter_map(|&x| x).sum();
    println!("Sum: {}", sum);
}
```

## Tip 52
-------

`Fn`ã€`FnMut` å’Œ `FnOnce` åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿè¿™äº›æ˜¯ç”¨äºå°†é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’çš„ç‰¹æ®Š traitã€‚

* `Fn`ï¼šä¸ä¿®æ”¹ç¯å¢ƒçš„é—­åŒ…
    
* `FnMut`ï¼šå¯ä»¥ä¿®æ”¹ç¯å¢ƒ

* `FnOnce`ï¼šè¿è¡Œä¸€æ¬¡å¹¶æ¶ˆè€—ç¯å¢ƒ
    
è¿™é‡Œæœ‰ä¸€ä¸ªå±•ç¤º `FnMut` trait å®é™…è¿ç”¨çš„ä¾‹å­ï¼š

```rust
fn main() {
    let value = 10;
    // ä½¿ç”¨ Fn ç‰¹æ€§çš„é—­åŒ…
    let fn_closure = || println!("This is a Fn closure accessing a value: {}", value);
    fn_closure(); // å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ”¹å˜æ•è·çš„ç¯å¢ƒ
    println!("{}", value);

    let mut mutable_value = 20;
    // ä½¿ç”¨ FnMut ç‰¹æ€§çš„é—­åŒ…
    let mut fnmut_closure = || {
        mutable_value += 10;
        println!(
            "This is a FnMut closure modifying a value: {}",
            mutable_value
        );
    };
    fnmut_closure(); // å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å¯ä»¥ä¿®æ”¹ç¯å¢ƒ
    println!("{}", mutable_value);

    let xx = String::from("sdasdasdasdasda");
    // å®šä¹‰ä¸€ä¸ª FnOnce é—­åŒ…ï¼Œå®ƒå°†æ¶ˆè€—ï¼ˆå–å¾—æ‰€æœ‰æƒï¼‰å®ƒæ•è·çš„å˜é‡ xx
    let consume = move || {
        let yy = format!("{}--{}", xx, "eeeeeeeeee");
        // åœ¨è¿™é‡Œï¼Œxx è¢«é—­åŒ…æ¶ˆè€—ã€‚é—­åŒ…æ‹¥æœ‰äº† xx çš„æ‰€æœ‰æƒï¼Œå¹¶å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚
        println!("Consumed string: {}", yy);
        // ç”±äº xx çš„æ‰€æœ‰æƒå·²ç»è¢«ç§»åŠ¨åˆ°é—­åŒ…å†…ï¼Œå®ƒåœ¨é—­åŒ…å¤–éƒ¨ä¸å†å¯ç”¨ã€‚
    };
    consume(); // è°ƒç”¨é—­åŒ…ï¼Œæ¶ˆè€— xx
    // å°è¯•å†æ¬¡ä½¿ç”¨ xx å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯
    // println!("{}", xx); // è¿™è¡Œå¦‚æœå–æ¶ˆæ³¨é‡Šï¼Œå°†å¯¼è‡´ç¼–è¯‘é”™è¯¯
}
```

## Tip 53
-------

ç»§ç»­æ¢è®¨â€œæ ¸å¿ƒâ€æˆ–â€œç³»ç»Ÿâ€ trait çš„ä¸»é¢˜ï¼Œ`Drop` trait éå¸¸æœ‰è¶£ï¼šä»»ä½•è¶…å‡ºä½œç”¨åŸŸçš„æ•°æ®ç±»å‹éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨`Drop()`ã€‚å› æ­¤ï¼Œå¦‚æœä½ å®ç°äº†`Drop()`ï¼Œå°±å¯ä»¥åœ¨éœ€è¦æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ¸…ç†æ“ä½œã€‚

```rust
fn main() {
    struct CustomResource {
        name: String,
    }

    impl Drop for CustomResource {
        fn drop(&mut self) {
            println!("Releasing custom resource: {}", self.name);
        }
    }

    let _ = CustomResource {
        name: String::from("MyResource"),
    };

    println!("CustomResource created.");

    // å½“ main å‡½æ•°ç»“æŸæ—¶ï¼Œresource è¶…å‡ºä½œç”¨åŸŸï¼ŒRust è‡ªåŠ¨è°ƒç”¨ Drop trait çš„ drop æ–¹æ³•
}
```

## Tip 54
-------

åœ¨ä½¿ç”¨å¼‚æ­¥ Rust å¼€å‘æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œä¸¤ä¸ªï¼ˆä¸ç›¸å…³ï¼‰ä»»åŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª `futures` #åº“çš„ `join!` å®å¹¶è¡Œåœ°è°ƒåº¦å®ƒä»¬ã€‚ç›¸æ¯”äºä¾æ¬¡è°ƒç”¨ `.await`ï¼Œè¿™æ ·åšå¯ä»¥æ›´é«˜æ•ˆï¼š

```rust
#[tokio::main]
async fn main() {
    use futures::join;

    async fn task1() -> u32 {
        42
    }

    async fn task2() -> u32 {
        24
    }

    let (result1, result2) = join!(task1(), task2());
    println!("Result: {}", result1 + result2);
}
```

## Tip 55
-------

éœ€è¦æ·±å…¥æ¢ç´¢äº† Rust ä¸­å£°æ˜å¼å®çš„ä¸–ç•Œã€‚ç¬¬ä¸€æ­¥æ˜¯è¦ç†è§£åŸºæœ¬è¯­æ³•â€¦â€¦è¿™ç¡®å®å¾ˆéš¾ç”¨æ–‡å­—æè¿°ï¼Œè¿™é‡Œæœ‰ä¸€å¼ ï¼ˆå¸Œæœ›æ˜¯æœ‰æ•™è‚²æ„ä¹‰çš„ï¼‰å›¾ç‰‡ï¼Œæ¶µç›–äº†åŸºç¡€çŸ¥è¯†ï¼š

![image](https://colobu.com/2024/06/09/rust-tips-41-60/3.png)

[macros-help-doc](https://doc.rust-lang.org/reference/macros.html)

## Tip 56
-------

åœ¨ä¸Šä¸€æ¡çš„å®è¯é¢˜åŸºç¡€ä¸Šï¼Œä»Šå¤©æˆ‘æ¢è®¨äº† 10 ä¸ªåŒ¹é…å™¨åŠ ä¸Šä¸Šæ¬¡å¸–å­ä¸­é—æ¼çš„ "ident" åŒ¹é…å™¨ã€‚æ¥çœ‹çœ‹è¿™å¼ å±•ç¤ºäº†æ¯ä¸ªåŒ¹é…å™¨çš„ç¤ºä¾‹çš„ç½‘æ ¼å›¾å§ï¼š

![image](https://colobu.com/2024/06/09/rust-tips-41-60/4.png)

## Tip 57
-------

åœ¨ Rust ä¸­ï¼Œä½ å¯ä»¥å®ç°åœ¨ä¸‰ä¸ªä¸»è¦ä½ç½®ç¼–å†™æµ‹è¯•ï¼š

* ä½œä¸ºæ–‡æ¡£çš„ä¸€éƒ¨åˆ†ï¼ˆdoctestï¼‰

```rust
/// å¯¹ä¸¤ä¸ªæ•°æ±‚å’Œã€‚
///
/// # ç¤ºä¾‹
///
/// ```
/// let result = my_crate::add(2, 3);
/// assert_eq!(result, 5);
/// ```
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}
```
    
* ä»£ç ä¸‹æ–¹çš„åµŒå…¥å¼æµ‹è¯•ï¼ˆ`#[cfg(test)]`å±æ€§åŒ…è£¹ï¼‰

```rust
fn add(a: i32, b: i32) -> i32 {
    a + b
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }
}
```
    
* å¤–éƒ¨çš„æµ‹è¯•æ–‡ä»¶å¤¹ä¸­

```rust
// æ–‡ä»¶è·¯å¾„: tests/integration_test.rs

// ä½¿ç”¨å¤–éƒ¨åº“
extern crate my_crate;

#[test]
fn test_add() {
    assert_eq!(my_crate::add(2, 3), 5);
}
```
    
ğŸ‘‰ é€šè¿‡æ‰§è¡Œ "cargo test" æ¥è¿è¡Œæµ‹è¯•

## Tip 58
-------

Rust çš„ç±»å‹ç³»ç»Ÿå…è®¸æˆ‘ä»¬å®šä¹‰â€œæ ‡è®°ç±»å‹â€ï¼Œè¿™äº›å¯ä»¥ä»…ä»…æ˜¯å¸¦æœ‰åå­—çš„ç»“æ„ä½“ï¼Œç”¨æ¥ä¸ºç‰¹å®šç±»å‹ç¼–ç å…ƒæ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ ‡è®°ç»“æ„ä½“ç¤ºä¾‹ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£ç»“æ„ä½“å¯ä»¥å¤„äº "è‰ç¨¿" æˆ– "å·²å‘å¸ƒ" çŠ¶æ€ï¼š

```rust
fn main() {
    // Marker structs representing states
    struct Draft;
    struct Published;
    // The Document struct, parameterized by its state
    struct Document<State> {
        content: String,
        _state: std::marker::PhantomData<State>,
    }
    impl Document<Draft> {
        // Constructor for a new draft document
        fn new(content: String) -> Document<Draft> {
            Document {
                content,
                _state: std::marker::PhantomData,
            }
        }
        // Review the document
        fn review(self) -> Document<Published> {
            Document {
                content: self.content,
                _state: std::marker::PhantomData,
            }
        }
    }
    impl Document<Published> {
        // Publish the document
        fn publish(self) {
            println!("Publishing document: {}", self.content);
        }
    }
    
    // Example usage
    let draft = Document::<Draft>::new(String::from("My Draft Document"));
    let published = draft.review(); // Review the document to move it to the Published state
    published.publish(); // Now the document can be published
}
```

## Tip 59
-------

é‡åˆ°äº†å‡ æ¬¡å°è¯•å®ç°ä¸€ä¸ªæ‰©å±• trait ä½†ç¼–è¯‘å™¨ä¸å…è®¸çš„æƒ…å†µã€‚äº‹å®è¯æ˜ï¼Œæœ‰ä¸¤ä¸ªè§„åˆ™éœ€è¦æ³¨æ„ï¼š

1. å¦‚æœ trait æ˜¯åœ¨ä½ çš„ crate ä¸­å®šä¹‰çš„ï¼Œä½ å¯ä»¥ä¸ºä»»ä½•ç±»å‹å®ç°æ‰©å±•ï¼Œå³ä½¿æ˜¯å…¶ä»– crate ä¸­çš„ç±»å‹ã€‚

```rust
// å®šä¹‰ä¸€ä¸ªç®€å•çš„ trait
trait Greet {
    fn greet(&self) -> String;
}

// ä¸ºæ ‡å‡†åº“ä¸­çš„ String ç±»å‹å®ç° Greet trait
impl Greet for String {
    fn greet(&self) -> String {
        format!("Hello, {}", self)
    }
}

fn main() {
    let my_string = "World".to_string();
    println!("{}", my_string.greet()); // è¾“å‡º: Hello, World
}
```
    
2. å¦‚æœ trait æ˜¯åœ¨å¦ä¸€ä¸ª crate ä¸­å®šä¹‰çš„ï¼Œä½ åªèƒ½ä¸ºä½  crate ä¸­å®šä¹‰çš„ç±»å‹å®ç°å®ƒã€‚
    
æ‰©å±• trait åŸºæœ¬ä¸Šå…è®¸åŸºäº trait å®šä¹‰ï¼Œå‘ä¸€ä¸ªç±»å‹æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚

**è¿™ä¸ªç¤ºä¾‹ä¸­çš„ external æ¨¡å—ä»…ç”¨äºæ¨¡æ‹Ÿå¤–éƒ¨ crate çš„æƒ…å†µï¼Œå®é™…ä¸Šä½ ä¸èƒ½ä¸ºçœŸæ­£çš„å¤–éƒ¨ crate ä¸­çš„ç±»å‹è¿™æ ·ç›´æ¥å®ç° traitã€‚ä½¿ç”¨æ–°ç±»å‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆ**

```rust
// å‡è®¾è¿™æ˜¯å¤–éƒ¨ crate ä¸­å®šä¹‰çš„ trait å’Œç±»å‹
mod external {
    pub trait ExternalTrait {
        fn do_something(&self);
    }

    pub struct ExternalType;
}

// æˆ‘ä»¬çš„ crate
struct MyWrapper(external::ExternalType);

// ä¸º MyWrapper å®ç°å¤–éƒ¨å®šä¹‰çš„ trait
impl external::ExternalTrait for MyWrapper {
    fn do_something(&self) {
        // å®ç°ç»†èŠ‚
        println!("Doing something with MyWrapper!");
    }
}

fn main() {
    let my_wrapper = MyWrapper(external::ExternalType);
    my_wrapper.do_something();
}
```

## Tip 60
-------

å½“åœ¨ç»“æ„ä½“ä¸Š #æ´¾ç”Ÿ `Debug` trait æ—¶ï¼Œä¼šå¾—åˆ°ä¸¤ç§ç”¨äº `println!` çš„æ ¼å¼åŒ–æ–¹å¼ï¼š

* `{:?}` é»˜è®¤çš„è°ƒè¯•æ ¼å¼åŒ–å™¨
    
* `{:#?}` â€œç¾åŒ–æ‰“å°â€çš„è°ƒè¯•æ ¼å¼åŒ–å™¨
    
è¿™ä¸¤ç§è¾“å‡ºçš„è§†è§‰å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç®€å•æ‰§è¡Œä¸€ä¸‹ï¼š

```rust
#[derive(Debug)]
struct Person {
    name: String,
    age: u8,
}

fn main() {
    let person = Person {
        name: String::from("Alice"),
        age: 30,
    };

    // ä½¿ç”¨é»˜è®¤çš„è°ƒè¯•æ ¼å¼åŒ–å™¨
    println!("{:?}", person);

    // ä½¿ç”¨â€œç¾åŒ–æ‰“å°â€çš„è°ƒè¯•æ ¼å¼åŒ–å™¨
    println!("{:#?}", person);
}
```

```bash
â¯ cargo run 
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
     Running `target/debug/synchronous`
Person { _name: "Alice", _age: 30 }
Person {
    _name: "Alice",
    _age: 30,
}
```