# Rust tips 21~40

Tip #21
-------

åœ¨ Rust ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ `Clone()` æˆ– `Copy()`ã€‚è¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

* `Copy`ï¼šæ”¯æŒ `Copy` çš„ç±»å‹å¯ä»¥å®‰å…¨åœ°é€šè¿‡å­—èŠ‚å¤åˆ¶çš„æ–¹å¼è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥ç±»æ¯” C è¯­è¨€ä¸­çš„ `memcpy` å‡½æ•°ã€‚
    
* `Clone`ï¼šæ”¯æŒ `Clone` çš„ç±»å‹ä¹Ÿå¯ä»¥è¢«å¤åˆ¶ï¼Œä½†å®ƒé€šå¸¸éœ€è¦æ‰§è¡Œä¸€äº›é€»è¾‘æ“ä½œæ¥å®Œæˆæ·±æ‹·è´ã€‚
    
Tip #22
-------

Rust ä¸­æœ‰ `static` å˜é‡ï¼Œå¯ä»¥ç”¨æ¥è¿½è¸ªæŸäº›çŠ¶æ€ã€‚å½“ç„¶ï¼Œ å¯å˜çš„é™æ€å˜é‡ ï¼ˆmutable staticï¼‰æ˜¯ä¸æ”¯æŒçš„ï¼Œä½†å¯¹äºåŸå§‹ç±»å‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨**std::sync::atomic**ã€‚è¿™äº›å¯ä»¥è¢«å®ä¾‹åŒ–ä¸ºé™æ€çš„ï¼Œå¹¶ä¸”åœ¨åç»­å¯ä»¥è¢«ä¿®æ”¹ï¼š

```rust
staticÂ COUNTER:Â AtomicUsizeÂ =Â AtomicUsize::new(0);      
//Â FunctionsÂ toÂ getÂ andÂ incrementÂ *static*Â counter.   
fnÂ increment_counter()Â {
    COUNTER.fetch_add(1,Â order:Â Ordering::Relaxed);
}      

fnÂ get_counter()Â ->Â usizeÂ {
    COUNTER.load(order:Â Ordering::Relaxed)
}
```

Tip #23
-------

å¯¹äºå¤§å¤šæ•°ä½¿ç”¨æ ¸å¿ƒæ•°æ®ç±»å‹çš„ç»“æ„ä½“ï¼Œä½ å¯ä»¥é€šè¿‡æ´¾ç”Ÿ `Default` trait è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„**Default()**å®ç°ï¼š

```rust
[derive(Default)]   
structÂ MyStructÂ {Â ...Â }
```

Tip #24
-------

æ¢ç´¢æ™ºèƒ½æŒ‡é’ˆï¼š

* `Box<T>` ç”¨äºç‹¬å æ‰€æœ‰æƒï¼Œä¸€æ—¦å®ƒæ‰€åœ¨çš„ä½œç”¨åŸŸ `{}` ç»“æŸï¼Œå®ƒå°±ä¼šè¢«é‡Šæ”¾ã€‚
    
* `Rc<T>` æ˜¯ä¸€ç§å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆã€‚åªæœ‰å½“å®ƒçš„æ‰€æœ‰å¼•ç”¨éƒ½ä¸å­˜åœ¨æ—¶ï¼Œå®ƒæ‰ä¼šè¢«é‡Šæ”¾ã€‚
    
* `Arc<T>` æ˜¯ `Rc<T>` çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ã€‚
    
Tip #25
-------

åœ¨ Rust ä¸­ï¼Œtrait çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„**æ¥å£**å®šä¹‰ã€‚å®ç°æŸä¸ª trait çš„ç»“æ„ä½“æˆ–æšä¸¾ï¼Œåœ¨å¥‘çº¦ä¸Šå¿…é¡»æä¾› trait ä¸­æŒ‡å®šç­¾åçš„å‡½æ•° :

```rust
fn main() {
    // Define a trait `Describable`
    trait Describable {
        fn describe(&self) -> String;
    }
    
    struct Person {
        name: String,
        age: u32,
    }
    
    // Implement the `Describable` trait for `Person`
    impl Describable for Person {
        fn describe(&self) -> String {
            format!("{} is {} years old.", self.name, self.age)
        }
    }
    let p = &Person{name: "John".to_string(), age: 25};
    println!("{}", p.describe());
}
```

Tip #26
-------

ä½ çŸ¥é“ Rust æ”¯æŒå¯¹å¤§å¤šæ•°å¸¸è§æ•°æ®ç±»å‹è¿›è¡Œ**è§£æ„**å—ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå…³äºç»“æ„ä½“çš„ä¾‹å­ï¼š

```rust
fn main() {
    struct Rocket {
        name: String,
        num_engines: u32,
    }
    
    let falcon9: Rocket = Rocket{name: "Falcon 9".to_string(), num_engines: 9};
    
    // Destructure name and engines
    let Rocket {name: the_name, num_engines: the_engines} = falcon9;
    
    println!("Rocket name {}, num engines {}", the_name, the_engines);
}
```

è¿™ç§è§£æ„æ–¹å¼å…è®¸ä½ åœ¨ä¸€è¡Œä¸­ä»ç»“æ„ä½“ä¸­æå–å¤šä¸ªå­—æ®µï¼Œå¹¶ç»™å®ƒä»¬èµ·æ–°çš„åå­—æˆ–æŒ‡å®šç±»å‹ï¼Œè¿™åœ¨å¤„ç†å¤æ‚æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚

Tip #27
-------

Rust #åŒºé—´è¡¨è¾¾å¼ï¼š

* åŒ…å«åŒºé—´ï¼ˆåŒ…å« a åˆ° bï¼Œb ä¹ŸåŒ…æ‹¬åœ¨å†…ï¼‰ï¼š`a..=b`
    
* åŠå¼€åŒºé—´ï¼ˆåŒ…å« a åˆ° b-1ï¼‰ï¼š`a..b`
    
* ä» a å¼€å§‹ï¼š`a..`
    
* åˆ° b-1 ä¸ºæ­¢ï¼š`..b`
    
* åˆ° b ä¸ºæ­¢ï¼ˆåŒ…æ‹¬ bï¼‰ï¼š`..=b`
    
* å®Œæ•´åŒºé—´ï¼š`..`
    
Tip #28
-------

åŒºé—´è¡¨è¾¾å¼(ç»§ç»­)ï¼š åŒºé—´è¡¨è¾¾å¼å¯ä»¥åº”ç”¨äº for å¾ªç¯ï¼Œæˆ–ç”¨äºåˆ›å»ºè¿­ä»£å™¨ã€‚åˆ«å¿˜äº†è°ƒç”¨**collect()**æ¥å®é™…æ‰§è¡Œè¿­ä»£å™¨ï¼š

```rust
fn main() {
    let mut squares_a: Vec<u32> = vec![];

    for i in 1..=100 {
        squares_a.push(i * i);
    }
    println!("{:?}", squares_a);
    // Map ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½†ä¸ä¼šæ‰§è¡Œè®¡ç®—ã€‚
    let squares_b_it = (1..=100).map(|x: u32| x * x);
    {
        // ä½¿ç”¨ for å¾ªç¯éå†è¿­ä»£å™¨
        for square in squares_b_it {
            println!("{}", square);
        }
    }

    // Apply collect to "run" the iterator.
    let squares_b: Vec<u32> = (1..=100).map(|x: u32| x * x).collect();
    for square in squares_b {
        println!("{}", square);
    }
}
```

Tip #29
-------

è¿­ä»£å™¨å¯ä»¥é€šè¿‡ `chain()` æ–¹æ³•è¿›è¡Œè¿ç»­æ‹¼æ¥ã€‚Rust åœ¨å¤„ç†å¯èƒ½å«æœ‰æˆ–ä¸å«å€¼çš„ `Option` ç±»å‹çš„è¿ç»­æ“ä½œæ—¶è¡¨ç°å¾—å°¤ä¸ºä¼˜é›…ã€‚

`letÂ maybe_rocketÂ =Â Some("Starship");   letÂ rocketsÂ =Â vec!["falcon1",Â "falcon2"];      //Â ChainÂ theÂ twoÂ iteratorsÂ together.   forÂ iÂ inÂ rockets.iter().chain(maybe_rocket)Â {   Â Â Â Â println!("ğŸš€Â {}",Â i);   }`

Tip #30
-------

å¦‚æœéœ€è¦ä»¥éå¯å˜æ–¹å¼å°†å‘é‡ï¼ˆ`vector`ï¼‰ä¼ é€’ç»™å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ `&[T]`ï¼ˆç­‰åŒäº `&Vec<T>`ï¼‰ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„ `åˆ‡ç‰‡`ï¼ˆ`slice`ï¼‰ã€‚

åˆ‡ç‰‡çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼šå®ƒä»¬é¿å…äº†æ‰€æœ‰æƒçš„è½¬ç§»ï¼Œå¹¶ä¸”å¯¹äº #å¹¶å‘æˆ– #å¹¶è¡Œæ“ä½œæ˜¯å®‰å…¨çš„ã€‚

Tip #31
-------

åŠ¨æ€è°ƒåº¦ï¼ˆ`dynamic dispatch`ï¼‰ç®€å•æ¥è¯´ï¼Œæ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°å¤„ç†ä¸åŒç±»å‹çš„ç‰¹æ€§ï¼Œé€šè¿‡ä¸€ä¸ªå…¬å…±çš„ç‰¹è´¨ï¼ˆtraitï¼‰æ¥å®ç°ï¼Œä»è€Œä½¿å¾—ï¼ˆå…·æœ‰ Rust ç‰¹è‰²çš„ï¼‰å¤šæ€æˆä¸ºå¯èƒ½ã€‚

åœ¨ Rust ä¸­ï¼Œ`Box<dyn Trait>` é€šå¸¸è¡¨æ˜ä½¿ç”¨äº†åŠ¨æ€è°ƒåº¦ã€‚

Tip #32
-------

è¿­ä»£å™¨æä¾›äº†ä¸€äº›éå¸¸æ–¹ä¾¿çš„å®ç”¨åŠŸèƒ½ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯ `all()` æ–¹æ³•ï¼Œå®ƒä¼šæ£€æŸ¥è¿­ä»£å™¨ä¸­æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³ç»™å®šçš„æ¡ä»¶ã€‚

è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥ä¼˜é›…ä¸”ç¬¦åˆä¹ æƒ¯ç”¨æ³•çš„æ–¹å¼é‡å†™éš¾çœ‹çš„åŸºäº for å¾ªç¯çš„ä»£ç :

`//Â éš¾çœ‹çš„ä»£ç    fnÂ check_user_infos(user_infos:Â Vec<UserInfo>)Â ->Â boolÂ {   Â Â Â Â forÂ uÂ inÂ user_infos.iter()Â {   Â Â Â Â Â Â Â Â ifÂ !unique_tags.contains(&u.user_name.as_str())Â {   Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;   Â Â Â Â Â Â Â Â }   Â Â Â Â }   Â Â Â Â true   }      //Â ä¼˜é›…çš„ä»£ç    fnÂ check_user_infos(user_infos:Â Vec<UserInfo>)Â ->Â boolÂ {   Â Â Â Â user_infos.iter().all(|u|Â unique_tags.contains(&u.user_name.as_str()))   }`

Tip #33
-------

`let a: Arc<Mutex<Vec<f32>>>` è¿™æ ·çš„å£°æ˜åœ¨è§†è§‰ä¸Šæ˜¯å¦è®©ä½ è§‰å¾—å›°æ‰°ï¼Ÿè¿™æ—¶å¯ä»¥ä½¿ç”¨ `type`å…³é”®å­—æ¥å®šä¹‰ç±»å‹ **åˆ«å**ï¼ˆaliasï¼‰:

`typeÂ SharedSafeVec<T>Â =Â Arc<Mutex<Vec<T>>>`

è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ `SharedSafeVec<f32>` æ¥ä»£æ›¿ `Arc<Mutex<Vec<f32>>>`ã€‚

Tip #34
-------

`Option<T>.map()` æ˜¯ä¸€ç§å°†**é€‰é¡¹**ï¼ˆ`Option`ï¼‰ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„æä½³æ–¹å¼ã€‚å®ƒèƒ½é€æ˜åœ°å¤„ç† `None` å€¼çš„æƒ…å†µã€‚

è¯·çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°† `Option<u32>` è½¬æ¢ä¸º `Option<String>`ï¼š

`fnÂ main()Â {   Â Â Â Â letÂ number_option:Â Option<u32>Â =Â Some(42);   Â Â Â Â letÂ string_option:Â Option<String>Â =Â number_option.map(|num|Â num.to_string());      Â Â Â Â println!("{:?}",Â string_option);Â //Â è¾“å‡º:Â Some("42")      Â Â Â Â letÂ none_option:Â Option<u32>Â =Â None;   Â Â Â Â letÂ empty_string_option:Â Option<String>Â =Â none_option.map(|num|Â num.to_string());      Â Â Â Â println!("{:?}",Â empty_string_option);Â //Â è¾“å‡º:Â None   }`

Tip #35
-------

ä»€ä¹ˆæ˜¯ `trait bound`? å½“æˆ‘ä»¬å‘å¸¦æœ‰æ³›å‹å‚æ•°çš„å‡½æ•°ä¸­ä¼ é€’é¢å¤–çš„ trait åç§°ï¼Œä»¥ä¾¿é™åˆ¶è¯¥æ³›å‹ç±»å‹æ—¶ï¼Œå°±æ˜¯åœ¨è°ˆè®º`trait bound`ï¼š

`fnÂ some_function<T:Â TraitAÂ +Â TraitB>(param:Â T)Â {Â ...Â }`

ä½ å¯ä»¥ä½¿ç”¨ "+" è¿ç®—ç¬¦æ¥ç»„åˆå¤šä¸ªç‰¹è´¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œç±»å‹ T å°±éœ€è¦åŒæ—¶æ»¡è¶³ `TraitA` å’Œ `TraitB` è¿™ä¸¤ä¸ªç‰¹è´¨çš„è¦æ±‚ã€‚

Tip #36
-------

å¦‚éœ€ä»åº”ç”¨ç¨‹åºè·å–æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œå°è¯•å¯¼å‡ºç¯å¢ƒå˜é‡ `RUST_LOG={error, warn, info, debug, trace}`ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ `actix-web` è¿è¡Œçš„æœåŠ¡åœ¨ `trace` æ¨¡å¼ä¸‹çš„ç¤ºä¾‹ï¼Œå®ƒä¼šæä¾›è¶…çº§è¯¦å°½çš„æ—¥å¿—è¾“å‡ºï¼š !\[\[Pasted image 20240608183308.png\]\]

Tip #37
-------

å…ƒç»„ç»“æ„ä½“å¯¹äºå°è£…å€¼å¹¶é™„åŠ å¯é€šè¿‡ Rust çš„ç±»å‹ç³»ç»ŸéªŒè¯çš„å…ƒæ•°æ®éå¸¸æœ‰ç”¨ã€‚

å…ƒç»„ç»“æ„ä½“çš„ä¸€ä¸ªå¦™ç”¨æ˜¯æ¨¡æ‹Ÿè®¡é‡å•ä½â€”â€”è¿™æ ·å°±ä¸ä¼šå†æ··æ·†è‹±å°ºå’Œç±³äº†ï¼š

`structÂ Feet(i32);Â //Â å®šä¹‰ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“ï¼Œè¡¨ç¤ºè‹±å°º   structÂ Meters(i32);Â //Â å®šä¹‰å¦ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“ï¼Œè¡¨ç¤ºç±³      implÂ From<Feet>Â forÂ MeterÂ {   Â Â Â Â fnÂ from(feet:Â Feet)Â ->Â SelfÂ {   Â Â Â Â Â Â Â Â Meter(feet.0Â *Â 0.3048)Â //Â å°†è‹±å°ºè½¬æ¢ä¸ºç±³   Â Â Â Â }   }      implÂ From<Meters>Â forÂ FeetÂ {   Â Â Â Â fnÂ from(meters:Â Meters)Â ->Â SelfÂ {   Â Â Â Â Â Â Â Â Feet(meters.0Â /Â 0.3048)Â //Â å°†ç±³è½¬æ¢ä¸ºè‹±å°º   Â Â Â Â }   }      fnÂ Â is_longer_enough(meters:Â Meters)Â ->Â boolÂ {   Â Â Â Â meters.0Â >Â 1   }      fnÂ is_longer_enough(feet:Â Feet)Â ->Â boolÂ {   Â Â Â Â feet.0Â >Â 3   }`

Tip #38
-------

æ­£åœ¨ç¼–å†™ä¸€ä¸ªå‡½æ•°ä½†è¿˜æ²¡å‡†å¤‡å¥½æœ€ç»ˆå®Œæˆï¼Ÿå¯ä»¥ä½¿ç”¨ `todo!()` æˆ– `unimplemented!()` å®æ¥è®©ä»£ç ä¿æŒå¯ç¼–è¯‘çŠ¶æ€ã€‚ä½†è¦è®°ä½ï¼Œå¦‚æœä½ çš„ç¨‹åºè¿è¡Œæ—¶é‡åˆ°è¿™äº›ç‚¹ï¼Œå®ƒå°†ä¼š`panic`ï¼è¿™å¯¹äºå¼€å‘é˜¶æ®µéå¸¸ç†æƒ³ã€‚ğŸš§

> â€œ
> 
> å’Œç¬¬å››æ¡é‡å¤äº†

Tip #39
-------

30 ç§’é€ŸæˆæŒ‡å—ï¼šæ„å»º Rust #æ¨¡å—

åˆ›å»ºä½ çš„æ¨¡å—ç»“æ„ï¼š

`my_module/   â”‚   â”œâ”€â”€ mod.rs   â”‚   â”œâ”€â”€ component_1.rs   â”‚   â””â”€â”€ component_2.rs`

åœ¨ mod.rs ä¸­æ·»åŠ ï¼š

`mod component_1;   mod component_2;`

æˆ–è€…æ–°çš„æ–¹å¼ï¼š

`my_module/   â”œâ”€â”€ component_1.rs   â””â”€â”€ component_2.rs   my_module.rs`

ğŸŒŸ å°è´´å£«ï¼šä½¿ç”¨`pub` å…³é”®å­—æ¥å®šä¹‰å…¬æœ‰è®¿é—®æƒé™ã€‚

Tip #40
-------

å®é™…ä¸Šï¼ŒRust ä¸­æœ‰ä¸¤ç§ç±»å‹çš„**å®**ã€‚`å£°æ˜å¼å®`ï¼ˆdeclarativeï¼‰å’Œæ›´é«˜çº§çš„ `è¿‡ç¨‹å¼å®`ï¼ˆproceduralï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ `macro_rules!` å®æ¥ç”Ÿæˆ `println` åŠŸèƒ½çš„å£°æ˜å¼å®ç¤ºä¾‹ï¼š

`macro_rules!Â my_printlnÂ {   Â Â Â Â ($($arg:tt)*)Â =>Â {   Â Â Â Â Â Â Â Â println!($($arg)*);   Â Â Â Â };   }      fnÂ main()Â {   Â Â Â Â my_println!("Hello,Â Rust!");   }`

è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º `my_println!` çš„å®ï¼Œå®ƒæ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°å¹¶ç®€å•åœ°å°†å®ƒä»¬ä¼ é€’ç»™æ ‡å‡†åº“çš„ `println!` å®ï¼Œä»è€Œè¾¾åˆ°æ‰“å°è¾“å‡ºçš„ç›®çš„ã€‚è¿™æ˜¯å£°æ˜å¼å®çš„ä¸€ä¸ªåŸºæœ¬åº”ç”¨ï¼Œå®ƒä»¬åŸºäºè§„åˆ™åŒ¹é…å¹¶åœ¨ç¼–è¯‘æ—¶å±•å¼€ã€‚ 